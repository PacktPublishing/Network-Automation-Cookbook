! boot system flash:/vEOS-lab.swi
!
hostname dc1-leaf02
!
snmp-server enable traps
!
spanning-tree mode none
!
aaa authorization exec default local
!
username ansible privilege 15 role network-admin secret ansible123
!
ip name-server vrf default 172.20.1.1
ip name-server vrf default 172.20.1.15
!
vrf definition MGMT
!
interface Management1
   vrf forwarding MGMT
   ip address 172.20.1.42/28
   no lldp transmit
   no lldp receive
!
ip route vrf MGMT 10.8.0.0/24 172.20.1.33
ip route vrf MGMT 172.20.1.0/24 172.20.1.33
ip route vrf MGMT 192.168.0.0/24 172.20.1.33
!
ip routing
ip routing vrf MGMT
!
!
management api http-commands
   no shutdown
   !
   vrf MGMT
      no shutdown
!
management console
   idle-timeout 300
!
management ssh
   idle-timeout 300
   authentication mode password
   login timeout 300
!
!
interface Ethernet8
   description "DC1 | Rpeer: spine01 | Rport: Ethernet2"
   no switchport
   ip address 172.31.1.3/31
!
interface Ethernet9
   description "DC1 | Rpeer: spine02 | Rport: Ethernet2"
   no switchport
   ip address 172.31.1.13/31
!
!
interface Loopback0
   ip address 10.100.1.2/32
!
!
vlan 20
   name VLAN_20
!
!
interface Vxlan1
   vxlan source-interface Loopback0
   vxlan udp-port 4789
   vxlan vlan 20 vni 1020
!
!
interface Ethernet1
   description "Access"
   switchport mode access
   switchport access vlan 20
!

!
router bgp 65002
!
  vlan 20
      rd 10.100.1.2:1020
      route-target both 1020:1020
      redistribute learned
   !
!
!
route-map loopback permit 10
   match ip address prefix-list loopback
!
!
ip prefix-list loopback
    seq 10 permit 10.100.1.2/32
!
!
router bgp 65002
   router-id 10.100.1.2
   maximum-paths 2
   bgp bestpath tie-break router-id
   neighbor SPINE peer-group   
   neighbor SPINE description "Peer Group for All SPINE Nodes"
   neighbor SPINE graceful-restart-helper
   neighbor SPINE send-community standard extended
   neighbor SPINE maximum-routes 100000 warning-only
   neighbor 172.31.1.2 peer-group SPINE
   neighbor 172.31.1.2 remote-as 65100
   neighbor 172.31.1.12 peer-group SPINE
   neighbor 172.31.1.12 remote-as 65100
   redistribute connected route-map loopback
   !
   address-family ipv4
      neighbor SPINE activate
      neighbor SPINE route-map loopback out
!


service routing protocols model multi-agent
!
router bgp 65002

   neighbor SPINE_EVPN peer-group   
   neighbor SPINE_EVPN description "Peer Group for All SPINE_EVPN EVPN Nodes"
   neighbor SPINE_EVPN graceful-restart-helper
   neighbor SPINE_EVPN send-community extended
   neighbor SPINE_EVPN maximum-routes 100000 warning-only
   neighbor SPINE_EVPN ebgp-multihop 2
   neighbor SPINE_EVPN update-source Loopback0
   neighbor 10.100.1.254 peer-group SPINE_EVPN
   neighbor 10.100.1.254 remote-as 65100
   neighbor 10.100.1.253 peer-group SPINE_EVPN
   neighbor 10.100.1.253 remote-as 65100
   !
   address-family evpn
      neighbor SPINE_EVPN activate
   !
   address-family ipv4
      no neighbor SPINE_EVPN activate
!

